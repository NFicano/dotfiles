#!/bin/bash
#/ NAME
#/      {{ basename }} -- setup homebrew
#/ 
#/ SYNOPSIS
#/      {{ basename }} <arguments> ...
#/ 
#/ DESCRIPTION
#/      
#/ 
#/ USAGE
#/      Demonstration of the usecases described in the description.

set -o errexit          # Exit on most errors (see the manual)
set -o nounset          # Disallow expansion of unset variables
#set -o errtrace        # Make sure any error trap is inherited (BASH only)
#set -o pipefail        # Use last non-zero exit code in a pipeline (BASH only)
#set -o xtrace          # Trace the execution of the script (UNCOMMENT TO DEBUG)

usage () {
    grep '^#/ ' < "$0" | cut -c4- | sed "s/{{ basename }}/${0##*/}/"
    exit 1
}

[ $# -ne 0 ] && usage


includeif() {
    [[ -d "$1" ]] && PATH="$1:${PATH}"
}

sourceif() {
    # shellcheck source=/dev/null
    [[ -f "$1" ]] && source "$1"
}

# shellcheck disable=SC2155
export HOMEBREW_PREFIX="$(brew --prefix)"

export HOMEBREW_CELLAR="$HOMEBREW_PREFIX/Cellar";
export HOMEBREW_REPOSITORY="$HOMEBREW_PREFIX/Homebrew";
export HOMEBREW_SHELLENV_PREFIX="$HOMEBREW_PREFIX";
export MANPATH="$HOMEBREW_PREFIX/share/man${MANPATH+:$MANPATH}:";
export INFOPATH="$HOMEBREW_PREFIX/share/info:${INFOPATH:-}";

includeif "$HOMEBREW_PREFIX/opt/coreutils/libexec/gnubin"
includeif "$HOMEBREW_PREFIX/opt/gnu-tar/libexec/gnubin"
includeif "$HOMEBREW_PREFIX/opt/grep/libexec/gnubin"
includeif "$HOMEBREW_PREFIX/opt/icu4c/bin"
includeif "$HOMEBREW_PREFIX/opt/icu4c/sbin"
includeif "$HOMEBREW_PREFIX/opt/openssl/bin"
includeif "$HOMEBREW_PREFIX/opt/openjdk/bin"
includeif "$HOMEBREW_PREFIX/opt/e2fsprogs/bin"
includeif "$HOMEBREW_PREFIX/opt/e2fsprogs/sbin"
includeif "$HOMEBREW_PREFIX/bin"
includeif "$HOMEBREW_PREFIX/sbin"

sourceif "$HOMEBREW_PREFIX/etc/bash_completion.d"
sourceif "$HOMEBREW_PREFIX/opt/git-extras/share/git-extras/git-extras-completion.sh"
sourceif "$HOMEBREW_PREFIX/opt/nvm/nvm.sh"
sourceif "$HOMEBREW_PREFIX/bin/virtualenvwrapper_lazy.sh"
sourceif "$HOMEBREW_PREFIX/etc/bash_completion"
